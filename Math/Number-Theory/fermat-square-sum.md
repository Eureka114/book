# 双平方定理（费马平方和定理）

## 费马平方和定理

费马平方和定理，也称双平方定理，是指由法国数学家费马在1640年提出的一个猜想，但他没有提出有力的数学证明，1747年，瑞士数学家莱昂哈德·欧拉提出证明后成为定理。

费马平方和定理的表述是：奇质数能表示为两个平方数之和的充分必要条件是该素数被4除余1。

## 费马平方和定理的证明

以下采用欧拉的证明方法，证明共分五步。

### 第一步

命题：（婆罗摩笈多-斐波那契恒等式）如果两个整数都能表示为两个平方数之和，则它们的积也能表示为两个平方数之和。（平方分解数的积是平方分解数。）

证明：婆罗摩笈多-斐波那契恒等式是以下两个恒等式：

$$
   \begin{aligned}
      (a^2+b^2)(c^2+d^2)=(ac+bd)^2+(ad-bc)^2\\
      (a^2+b^2)(c^2+d^2)=(ac-bd)^2+(ad+bc)^2
   \end{aligned}
$$



该恒等式在整数环、有理数环和任何的交换环中都成立。

其在数论中的应用是：费马平方和定理说明任何被4除余1的素数都能表示为两个平方数的和，则根据婆罗摩笈多-斐波那契恒等式，任何两个被4除余1的素数的积也都能表示为两个平方数的和。

### 第二步

命题：如果一个能表示为两个平方数之和的整数被另一个能表示为两个平方数之和的素数整除，则它们的商也能表示为两个平方数之和。（平方分解数被素平方分解数整除的商是平方分解数。）

证明：设$p^2+q^2\mid a^2+b^2$。其中，$p^2+q^2$为素数。则有$p^2+q^2\mid (ap+bq)(ap-bq)$。


$$
   (ap+bq)(ap-bq)=a^{2}p^{2}-b^{2}q^{2}=a^{2}\left(p^{2}+q^{2}\right)-q^{2}\left(a^{2}+b^{2}\right)
$$


由于$p^{2}+q^{2}$是质数，则它整除其中一个因子，不妨设$p^{2}+q^{2} \mid (ap+bq)$，另一种情况同理。整理上面的式子，有：（两侧同时乘以$(p^2+q^2)$，并使用婆罗摩笈多-斐波那契恒等式）


$$
   \left(p^{2}+q^{2}\right)^{2} \mid\left(a^{2}+b^{2}\right)\left(p^{2}+q^{2}\right)=(ap+bq)^{2}+(aq-bp)^{2}
$$

$$
   (p^2+q^2)^2|(aq-bp)^2
$$


推出$p^2+q^2\mid aq-bp$，因此，


$$
   \frac{a^2+b^2}{p^2+q^2}=\frac{(a^2+b^2)(p^2+q^2)}{(p^2+q^2)^2}=\left(\frac{ap+bq}{p^2+q^2}\right)^2+\left(\frac{aq-bp}{p^2+q^2}\right)^2
$$

### 第三步

命题：如果一个能表示为两个平方数之和的整数被另一个不能表示为两个平方数之和的整数整除，则它们的商也必有一个不能表示为两个平方数之和的因子。（平方分解数被非平方分解数整除的商必有一个非平方分解因子。）

证明：反证。假设$\dfrac{a^2+b^2}{x}=p_1p_2\ldots p_n$，$p_i$均是素数，$x$不为平方分解数。下面先假设$p_1p_2\ldots p_n$均是平方分解数。根据定理2，我们有：


$$
   \frac{a^2+b^2}{p_1}=x(\prod_{i=2}^n p_i)=z^2+r^2
$$


继续迭代：


$$
   \frac{a^2+b^2}{p_1p_2}=\frac{z^2+r^2}{p_2}=x(\prod_{i=3}^n p_i)=t^2+h^2
$$


最后，可以得到：


$$
   \frac{a^2+b^2}{\prod\limits_{i=1}^n p_i}=l^2+m^2=x
$$


与条件矛盾。故原假设不成立，原命题得证。

### 第四步

命题：如果a和b互素，则$a^2 + b^2$的所有因子都能表示为两个平方数之和。

证明：（无穷递降法：数论中常用的一种方法，意在通过某数列无限次的递减和最小元已经存在的矛盾来对命题进行反证、从而使该种递减操作不存在，论证原命题的正确。）

设$x\mid a^2+b^2$。记$a=mx\pm c$，$b=nx\pm d$。其中，$c,d$的绝对值不超过$x$的一半。（否则，可以通过扩大或缩小$m,n$的值来调整到$c,d$的绝对值不超过$x$的一半）。可得：


$$
   a^2 + b^2 = m^2x^2\pm 2mxc + c^2 + n^2x^2 \pm 2nxd + d^2 = Ax + (c^2+d^2)
$$


故$x\mid c^2+d^2$。记$c^2+d^2=x\cdot y$。

如果c和d不互素：记$\alpha=\gcd(c,d)$。则$\alpha$必须与$x$互质。

> 证明：改写上面的方程：$a=mx\pm c=mx\pm \alpha e$，$b=nx\pm \alpha f$。
>
> 若$\gcd(\alpha,x)\neq 1$，则$\gcd(a,b)\neq1$，与假设矛盾。

现在，有


$$
   c^2+d^2=\alpha^2(e^2+f^2)=xy.
$$



显然，$\alpha^2\mid y$。于是我们得到$e^2 + f^2 = x\cdot z$，其中$e,f$互素，$z=\dfrac{y}{\alpha^2}\le\dfrac{x}{2}$，这是因为


$$
   zx = e^2 + f^2 \leq c^2+d^2 \leq \left(\frac{x}{2}\right)^2 + \left(\frac{x}{2}\right)^2.
$$


如果c和d互素：则我们可直接使用c和d，不必转换成e和f。

如果x不能表示为两个平方数之和，则根据第三步的结论，可知必有一个z的因子不能表示为两个平方数之和；设它为w。于是我们从x推出了一个更小的整数w，都不能表示为两个平方数之和，但都能被一个能表示为两个平方数之和的整数整除。由于这个无穷递降是不可能的，因此x一定能表示为两个平方数之和。

### 第五步

命题：任何形为$4n + 1$的素数都能表示为两个平方数之和。

证明：如果$p = 4n + 1$，则根据费马小定理可得$1, 2^{4n}, 3^{4n},\ldots, (4n)^{4n}$被$p$除都余$1$。因此它们的差$2^{4n}-1, 3^{4n}-2^{4n},\ldots,(4n)^{4n}- (4n-1)^{4n}$都能被$p$​整除。这些差可分解为


$$
   a^{4n} - b^{4n} = \left(a^{2n}+b^{2n}\right)\left(a^{2n} - b^{2n}\right).
$$


由于$p$是素数，它一定能整除这两个因子之一〔以下称它们为“和因子”和“差因子”〕。如果它能整除任何一个“和因子”，则根据第四步的结论可得$p$能表示为两个平方数之和〔由于*a*和*b*仅相差1，它们必然互素〕。而如果它能整除所有的$4n - 1$个“差因子”$2^{2n} - 1, 3^{2n} - 2^{2n},\ldots,(4n)^{2n} - (4n-1)^{2n}$，则它也能整除$4n - 2$个一阶差、$4n - 3$个二阶差，依此类推。由于数列$1^k, 2^k, 3^k,\ldots$的第$k$阶差都等于$k$!，于是第$2n$阶差都等于$(2n)!$，显然它不能被$p$整除。因此，$p$不能整除所有的“差因子”，得证$p$能表示为两个平方数之和。

> 费马小定理：如果p是一个质数，而整数a不是p的倍数，则有$a^{p-1}\equiv 1(\text{mod }p)$。

## 参考文献

1. [Fermat's Sum of Two Squares Theorem part 1 · Charlie Spackman (rbind.io)](https://charlie-spackman.rbind.io/2018/07/07/fermats-sum-of-two-squares-theorem-part-1#:~:text=Fermat’s Sum of Two Squares,by Albert Girard in 1625)

2. [Fermat's Sum of Two Squares Theorem part 2 · Charlie Spackman (rbind.io)](https://charlie-spackman.rbind.io/2018/07/07/fermats-sum-of-two-squares-theorem-part-2)

3. [费马平方和定理- MBA智库百科](https://wiki.mbalib.com/wiki/费马平方和定理)
4. [费马平方和定理_百度百科](https://baike.baidu.com/item/费马平方和定理/12552916)
5. [无穷递降法- 知乎](https://zhuanlan.zhihu.com/p/338573099)
