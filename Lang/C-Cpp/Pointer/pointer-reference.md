# 指针和引用

## 指针和引用

### 概念

- 指针(Pointer)：指向某一块内存的变量，其本身存储的信息就是内存地址的首地址，其类型决定指向内存的大小。
- 变量：某一块内存地址数据值的名字。
- 引用：变量的别名。

> 举个例子：例如，对于在超市的储物柜：
>
> - 我记住我放包的柜子在第一排右起第三个，这里的1-3就是一个地址，通过地址，我可以找到柜子。这里的地址就是一个指针。
> - 我记住我放包的柜子上有一张贴纸，上面写着18，通过18，我可以找到柜子。这里的18，就是变量名了。
> - 柜子的贴纸上面写着18，但是18不好记，我用谐音记忆法，把18想成“要发”，通过“要发”，也可以找到柜子。这里“要发”就是一个引用。

在C++中，`*` 和 `&` 符号有多种用途，具体的含义取决于它们被使用的上下文。

1. `*` 符号：
	- 在声明中，`*` 表示一个变量是指针，例如 `int *p;` 表示 `p` 是一个指向整型的指针。
	- 在表达式中，`*` 用于解引用指针，获取指针指向的值，例如 `*p` 获取 `p` 指向的整型值。（取值操作符）
2. `&` 符号：
	- 在声明中，`&` 表示一个变量是引用，例如 `int &r = a;` 表示 `r` 是 `a` 的引用。
	- 在表达式中，`&` 用于获取变量的地址，例如 `&a` 获取 `a` 的地址。（取地址操作符）

这两个符号还可以组合使用，例如 `int *&p = q;` 表示 `p` 是一个指针，它引用了另一个指针 `q`。这意味着，通过 `p` 修改指针的值将改变 `q` 指向的地址。

### 区别

指针和引用在 C++ 中都用于间接访问变量，但它们有一些区别：

- 指针是一个变量，它保存了另一个变量的内存地址；引用是另一个变量的别名，与原变量共享内存地址。
- 指针可以被重新赋值，指向不同的变量；引用在初始化后不能更改，始终指向同一个变量。
- 指针可以为` nullptr`，表示不指向任何变量；引用必须绑定到一个变量，不能为 `nullptr`。
- 使用指针需要对其进行解引用以获取或修改其指向的变量的值；引用可以直接使用，无需解引用。

```cpp
#include <iostream>
int main() {
    int a = 10;
    int b = 20;

    // 指针
    int* p = &a;//在C++中，int* 和 int * 是完全相同的，但是，第一种写法更容易理解。如果要在一行内声明多个指针，只能这样写：int *p, *q;
    std::cout << "Pointer value: " << *p << std::endl; // 输出：Pointer value: 10

    p = &b;
    std::cout << "Pointer value: " << *p << std::endl; // 输出：Pointer value: 20

    // 引用
    int &r = a;
    std::cout << "Reference value: " << r << std::endl; // 输出：Reference value: 10

    // r = &b; // 错误：引用不能被重新绑定
    int &r2 = b;
    r = r2; // 将 b 的值赋给 a，r 仍然引用 a
    std::cout << "Reference value: " << r << std::endl; // 输出：Reference value: 20

    return 0;
}
```

### 使用例

还是以`int, int*, int&, int*&, int&*, int**`等为例。

#### `int`

```cpp
void swap(int a, int b){
    int temp=a;
    a=b;
    b=temp;
}
```

这里，只是象征性的进行了交换的操作，即只是交换了两个形参的值，而这两个参数仅在`swap函数内进行交换，不影响该函数的外部，故此函数起不到交换的效果。

#### `int*`

```cpp
void swap(int *a, int *b){
    int temp = *a;//先解引用，获取具体的数值
    *a = *b;//*b 表示获取指针 b 所指向的值，*a 表示获取指针 a 所指向的位置。
    *b = temp;//temp本来就是一个数值
}
int main(){
    int a, b;
    swap(&a, &b);//传入地址参数
    return 0;
}
```

`swap` 函数接受两个指向整数的指针作为参数。在函数内部，首先定义了一个临时变量 `temp`，并将 `a` **指向的值**赋给 `temp`。然后，将 `b` **指向的值**赋给 `a` **指向的位置**，最后将 `temp` **的值**赋给 `b` **指向的位置**。这样就完成了 `a` 和 `b` 的值的交换。

在C++中，函数参数默认是通过值传递的，也就是说，函数内部对参数的修改不会影响到外部的原始变量。但是，如果我们希望函数能够修改外部的原始变量，就需要通过指针或引用来传递参数。

#### `int&`

```cpp
void swap(int& m, int& n){//创建了两个引用变量。现在，m引用了a，n引用了b
    int temp=m;//把m的值赋值给temp，但是，m仍在引用a
    m=n;//把n的值赋值给了m。注意：现在，m仍在引用变量a，但是变量a的数值为原来b中存放的数据。
    n=temp;//把temp(a)赋值给了n。此时，n的引用没用改变，仍然是变量b，但是，变量b中的数值改变了
}//注意，引用不能被重新绑定，而上述的操作确实没有改变引用，而是通过赋值操作，把原变量中的两个数据进行了对调。
int main(){
    int a, b;
    swap(a, b);//只需要传入两个整数即可。
}
```

`swap` 函数接受两个整数的引用作为参数。在函数内部，首先定义了一个临时变量 `temp`，并将 `m` 的值赋给 `temp`。然后，将 `n` 的值赋给 `m`，最后将 `temp` 的值赋给 `n`。这样就完成了 `m` 和 `n` 的值的交换。

原因详见前文和上面的代码。

#### `int *&`

```cpp
void swap(int *&a, int *&b){//这里，传入了指针的引用这一种参数
    int temp = *a;
    *a = *b;
    *b = temp;
}
int main(){
    int a, b;
    int *aptr = &a, *bprt = &b;
    int *&arefptr = aptr, *&brefptr = bptr;
    swap(arefptr, brefptr);
}
```

略有些复杂，但是和前面的内容大同小异。注意形如 `int*& value`的声明：如果使用前桥和弥推荐的读法来理解的话，其可以被翻译为：`value`是一个指针的引用，即指针的别名。

（或许，可以这样理解：定义了整型变量`a`，则 `int* ptr = &a` 就是定义了一个整型指针变量`aptr`，其指向变量`a`的地址。这里，`a`也一并进行了取地址的操作。然后，又定义了一个引用`arefptr`，其是指针`aptr`的引用。）

#### <s>`int &*`</s>

这里的定义是非法的，但是却可以交换成功。

#### `int **`

即“指针的指针”。`int** ptrptr`的意思是`ptrptr`是一个指向某一个指针类型的指针。也就是“二重指针”。一般来说，这种写法在一般的比较简单的变量中不常见，而在二维数组中十分常见，这样写就可以代表这是一个指向某一个二维数组的指针。

## 参考资料

1. [C++基础019_指针和引用（`int*、int&、int*&、int&*、int**`） - 邵贤军 - 博客园 (cnblogs.com)](https://www.cnblogs.com/alephsoul-alephsoul/archive/2012/10/10/2719192.html)
2. [C++ 中指针和引用的区别 | 编程指北 (csguide.cn)](https://csguide.cn/cpp/memory/difference_of_pointers_and_ref.html#区别)

